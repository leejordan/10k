var fromIndex=0;var currentVideoId;function init(){loadThumbnails();bindCloseEvents();bindKeyboardControls();bindHoverEvent();bindBlurEvent();loadYoutubeApi();restrictFocusToModal();if(lastListItemIsInViewport()){loadMore()}window.onscroll=function(){if(lastListItemIsInViewport()){loadMore()}}}function getFile(a){var b=new XMLHttpRequest();b.open("GET",a,false);b.send(null);if(b.status==200){return b.responseText}}function isElementInViewport(a){var b=a.getBoundingClientRect();return(b.top>=0&&b.left>=0&&b.bottom<=(window.innerHeight+a.offsetHeight||document.documentElement.clientHeight+a.offsetHeight)&&b.right<=(window.innerWidth||document.documentElement.clientWidth))}function loadThumbnails(){var c=document.querySelectorAll("[data-id]");for(var a=0,b;b=c[a];a++){if(!b.getAttribute("style")){b.style.backgroundImage="url(https://i.ytimg.com/vi/"+b.getAttribute("data-id")+"/mqdefault.jpg)"}}}function lastListItemIsInViewport(){var a=document.querySelector(".list__vid:last-of-type");if(isElementInViewport(a)){return true}return false}function loadMore(){var b=false;var a=10;for(var c=fromIndex,d;d=videoData[c];c++){if(c<fromIndex+a&&c<Object.keys(videoData).length){appendListItem(d.id,d.title)}if(fromIndex===30&&c===39){var e=document.querySelectorAll("[data-id]");var f=e[e.length-4];for(var c=0;c<e.length;c++){e[c].removeEventListener("blur",loadMore,false)}window.onscroll=function(){return true};b=true;break}}if(lastListItemIsInViewport()&&!b){fromIndex=fromIndex+a;loadMore.call();return true}if(!b){bindBlurEvent()}fromIndex=fromIndex+a;loadThumbnails();bindHoverEvent()}function appendListItem(g,f){var b=document.getElementById("video-list");var d=document.createElement("li");var c=document.createElement("a");var e=document.createElement("h3");var a=document.createTextNode(f);e.appendChild(a);d.setAttribute("class","list__vid");b.appendChild(d);c.setAttribute("href","https://www.youtube.com/watch?v="+g);c.setAttribute("data-id",g);c.setAttribute("onclick",'return openModal("'+g+'")');c.appendChild(e);d.appendChild(c)}function loadYoutubeApi(){var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}function openModal(c){var a=document.getElementById("player-container");var b=document.getElementById("focused-element");currentVideoId=c;a.className="player-wrap active";document.body.className="player-open";b.focus();loadPlayer(c);restrictFocusToModal();return false}function restrictFocusToModal(){document.addEventListener("focus",checkModalActive,true)}function checkModalActive(b){var a=document.getElementById("player-container");var c=document.getElementById("focused-element");if(a.className==="player-wrap active"){b.stopPropagation();c.focus()}}function loadPlayer(a){player=new YT.Player("player",{height:"100%",width:"100%",videoId:a,events:{onReady:onPlayerReady}})}function onPlayerReady(a){a.target.playVideo()}function closePlayer(c){var a=document.getElementById("player-container");var b=document.querySelectorAll('[data-id="'+currentVideoId+'"]');document.removeEventListener("focus",checkModalActive,true);b[0].focus();a.className="player-wrap";document.body.className="";player.destroy();c.preventDefault()}function bindCloseEvents(){var b=document.querySelectorAll("[data-close]");for(var a=0;a<b.length;a++){b[a].addEventListener("click",closePlayer,false)}}function bindHoverEvent(){var b=document.querySelectorAll("[data-id]");for(var a=0;a<b.length;a++){b[a].removeEventListener("mouseover",deselectFocus);b[a].addEventListener("mouseover",deselectFocus,false)}}function deselectFocus(){if(document.activeElement!==document.body){document.activeElement.blur()}}function bindBlurEvent(){var b=document.querySelectorAll("[data-id]");var c=b[b.length-4];for(var a=0;a<b.length;a++){b[a].removeEventListener("blur",loadMore,false)}c.addEventListener("blur",loadMore,false)}function bindKeyboardControls(){document.body.addEventListener("keyup",function(a){if(a.keyCode==27){closePlayer(a)}})}init();